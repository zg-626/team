(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-store-settled-test"],{4157:function(t,e,i){"use strict";i.r(e);var a=i("75ed"),n=i("480c");for(var s in n)["default"].indexOf(s)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(s);i("50fc");var o=i("828b"),c=Object(o["a"])(n["default"],a["b"],a["c"],!1,null,"2740ef7b",null,!1,a["a"],void 0);e["default"]=c.exports},"480c":function(t,e,i){"use strict";i.r(e);var a=i("64a55"),n=i.n(a);for(var s in a)["default"].indexOf(s)<0&&function(t){i.d(e,t,(function(){return a[t]}))}(s);e["default"]=n.a},"50fc":function(t,e,i){"use strict";var a=i("ee9c"),n=i.n(a);n.a},"64a55":function(t,e,i){"use strict";i("6a54"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,i("5c47"),i("3efd"),i("aa9c"),i("e838"),i("1851");var a={data:function(){return{canvasName:"handWriting",ctx:"",canvasWidth:0,canvasHeight:0,transparent:1,selectColor:"black",lineColor:"#1A1A1A",lineSize:1.5,lineMin:.5,lineMax:4,pressure:1,smoothness:60,currentPoint:{},currentLine:[],firstTouch:!0,radius:1,cutArea:{top:0,right:0,bottom:0,left:0},bethelPoint:[],lastPoint:0,chirography:[],currentChirography:{},linePrack:[]}},onLoad:function(){var t=this,e=this.canvasName,i=wx.createCanvasContext(e);this.ctx=i;var a=wx.createSelectorQuery();a.select(".handCenter").boundingClientRect((function(e){t.canvasWidth=e.width,t.canvasHeight=e.height,t.setCanvasBg("rgba(0,0,0,0)")})).exec()},methods:{uploadScaleStart:function(t){if("touchstart"!=t.type)return!1;var e=this.ctx;e.setFillStyle(this.lineColor),e.setGlobalAlpha(this.transparent);var i={x:t.touches[0].x,y:t.touches[0].y},a=this.currentLine;a.unshift({time:(new Date).getTime(),dis:0,x:i.x,y:i.y}),this.currentPoint=i,this.firstTouch&&(this.cutArea={top:i.y,right:i.x,bottom:i.y,left:i.x},this.firstTouch=!1),this.pointToLine(a)},uploadScaleMove:function(t){if("touchmove"!=t.type)return!1;t.cancelable&&(t.defaultPrevented||t.preventDefault());var e={x:t.touches[0].x,y:t.touches[0].y};e.y<this.cutArea.top&&(this.cutArea.top=e.y),e.y<0&&(this.cutArea.top=0),e.x>this.cutArea.right&&(this.cutArea.right=e.x),this.canvasWidth-e.x<=0&&(this.cutArea.right=this.canvasWidth),e.y>this.cutArea.bottom&&(this.cutArea.bottom=e.y),this.canvasHeight-e.y<=0&&(this.cutArea.bottom=this.canvasHeight),e.x<this.cutArea.left&&(this.cutArea.left=e.x),e.x<0&&(this.cutArea.left=0),this.lastPoint=this.currentPoint,this.currentPoint=e;var i=this.currentLine;i.unshift({time:(new Date).getTime(),dis:this.distance(this.currentPoint,this.lastPoint),x:e.x,y:e.y}),this.pointToLine(i)},uploadScaleEnd:function(t){if("touchend"!=t.type)return 0;var e={x:t.changedTouches[0].x,y:t.changedTouches[0].y};this.lastPoint=this.currentPoint,this.currentPoint=e;var i=this.currentLine;if(i.unshift({time:(new Date).getTime(),dis:this.distance(this.currentPoint,this.lastPoint),x:e.x,y:e.y}),i.length>2)i[0].time,i[i.length-1].time,i.length;this.pointToLine(i);var a={lineSize:this.lineSize,lineColor:this.lineColor},n=this.chirography;n.unshift(a),this.chirography=n;var s=this.linePrack;s.unshift(this.currentLine),this.linePrack=s,this.currentLine=[]},retDraw:function(){this.ctx.clearRect(0,0,700,730),this.ctx.draw(),this.setCanvasBg("rgba(0,0,0,0)")},pointToLine:function(t){this.calcBethelLine(t)},calcBethelLine:function(t){if(t.length<=1)t[0].r=this.radius;else{var e,i,a,n,s,o,c,r,l,h,u=0,d=0;t.length<=2?(e=t[1].x,n=t[1].y,a=t[1].x+.5*(t[0].x-t[1].x),o=t[1].y+.5*(t[0].y-t[1].y),i=e+.5*(a-e),s=n+.5*(o-n)):(e=t[2].x+.5*(t[1].x-t[2].x),n=t[2].y+.5*(t[1].y-t[2].y),i=t[1].x,s=t[1].y,a=i+.5*(t[0].x-i),o=s+.5*(t[0].y-s)),l=this.distance({x:a,y:o},{x:e,y:n}),h=this.radius;for(var f=0;f<t.length-1;f++)if(u+=t[f].dis,d+=t[f].time-t[f+1].time,u>this.smoothness)break;this.radius=Math.min(d/l*this.pressure+this.lineMin,this.lineMax)*this.lineSize,t[0].r=this.radius,t.length<=2?(c=(h+this.radius)/2,r=c,r):(c=(t[2].r+t[1].r)/2,r=t[1].r,(t[1].r+t[0].r)/2);for(var v=[],p=0;p<5;p++){var x=p/4,g=(1-x)*(1-x)*e+2*x*(1-x)*i+x*x*a,y=(1-x)*(1-x)*n+2*x*(1-x)*s+x*x*o,b=h+(this.radius-h)/5*p;if(v.push({x:g,y:y,r:b}),3==v.length){var m=this.ctaCalc(v[0].x,v[0].y,v[0].r,v[1].x,v[1].y,v[1].r,v[2].x,v[2].y,v[2].r);m[0].color=this.lineColor,this.bethelDraw(m,1),v=[{x:g,y:y,r:b}]}}this.currentLine=t}},distance:function(t,e){var i=e.x-t.x,a=e.y-t.y;return Math.sqrt(i*i+a*a)},ctaCalc:function(t,e,i,a,n,s,o,c,r){var l,h,u,d,f,v,p,x,g,y=[];l=a-t,h=n-e,u=2*Math.sqrt(l*l+h*h+1e-4),l=l/u*i,h=h/u*i,d=h,f=-l,v=a-o,p=n-c,u=2*Math.sqrt(v*v+p*p+1e-4),v=v/u*r,p=p/u*r,x=-p,g=v,y.push({mx:t+d,my:e+f,color:"#1A1A1A"}),y.push({c1x:a+d,c1y:n+f,c2x:a+x,c2y:n+g,ex:o+x,ey:c+g}),y.push({c1x:o+x-v,c1y:c+g-p,c2x:o-x-v,c2y:c-g-p,ex:o-x,ey:c-g}),y.push({c1x:a-x,c1y:n-g,c2x:a-d,c2y:n-f,ex:t-d,ey:e-f}),y.push({c1x:t-d-l,c1y:e-f-h,c2x:t+d-l,c2y:e+f-h,ex:t+d,ey:e+f}),y[0].mx=y[0].mx.toFixed(1),y[0].mx=parseFloat(y[0].mx),y[0].my=y[0].my.toFixed(1),y[0].my=parseFloat(y[0].my);for(var b=1;b<y.length;b++)y[b].c1x=y[b].c1x.toFixed(1),y[b].c1x=parseFloat(y[b].c1x),y[b].c1y=y[b].c1y.toFixed(1),y[b].c1y=parseFloat(y[b].c1y),y[b].c2x=y[b].c2x.toFixed(1),y[b].c2x=parseFloat(y[b].c2x),y[b].c2y=y[b].c2y.toFixed(1),y[b].c2y=parseFloat(y[b].c2y),y[b].ex=y[b].ex.toFixed(1),y[b].ex=parseFloat(y[b].ex),y[b].ey=y[b].ey.toFixed(1),y[b].ey=parseFloat(y[b].ey);return y},bethelDraw:function(t,e,i){var a=this.ctx;a.beginPath(),a.moveTo(t[0].mx,t[0].my),void 0!=i?(a.setFillStyle(i),a.setStrokeStyle(i)):(a.setFillStyle(t[0].color),a.setStrokeStyle(t[0].color));for(var n=1;n<t.length;n++)a.bezierCurveTo(t[n].c1x,t[n].c1y,t[n].c2x,t[n].c2y,t[n].ex,t[n].ey);a.stroke(),void 0!=e&&a.fill(),a.draw(!0)},selectColorEvent:function(t,e){this.selectColor=t,this.lineColor=e},canvasToImg:function(t){this.ctx.draw(!0,(function(){wx.canvasToTempFilePath({canvasId:"handWriting",fileType:"png",quality:1,success:function(e){wx.showToast({title:"执行了吗？"}),t(e.tempFilePath)}})}))},subCanvas:function(){this.ctx.draw(!0,(function(){wx.canvasToTempFilePath({canvasId:"handWriting",fileType:"png",quality:1,success:function(t){wx.saveImageToPhotosAlbum({filePath:t.tempFilePath,success:function(t){wx.showToast({title:"已成功保存到相册",duration:2e3})}})}})}))},saveCanvasAsImg:function(){wx.canvasToTempFilePath({canvasId:"handWriting",fileType:"png",quality:1,success:function(t){wx.saveImageToPhotosAlbum({filePath:t.tempFilePath,success:function(t){wx.showToast({title:"已保存到相册",duration:2e3})}})}})},previewCanvasImg:function(){wx.canvasToTempFilePath({canvasId:"handWriting",fileType:"jpg",quality:1,success:function(t){wx.previewImage({urls:[t.tempFilePath]})}})},uploadCanvasImg:function(){wx.canvasToTempFilePath({canvasId:"handWriting",fileType:"png",quality:1,success:function(t){wx.uploadFile({url:"https://ksp.tbzhchina.com/invoice_manager/captcha/uploadSignFile",filePath:t.tempFilePath,name:"file_signature",formData:{user:"test"},success:function(t){1==t.code?wx.showToast({title:"上传成功",duration:2e3}):uni.showToast({title:t.message,icon:"none",position:"bottom",duration:3e3})}})}})},setCanvasBg:function(t){this.ctx.rect(0,0,this.canvasWidth,this.canvasHeight-4),this.ctx.setFillStyle(t),this.ctx.fill(),this.ctx.draw()},back:function(){uni.reLaunch({url:"/pages/ucenter/ucenter"})}}};e.default=a},"67d7":function(t,e,i){var a=i("c86c");e=a(!1),e.push([t.i,"uni-page-body[data-v-2740ef7b]{background:#fbfbfb;height:auto;overflow:hidden}body.?%PAGE?%[data-v-2740ef7b]{background:#fbfbfb}.wrapper[data-v-2740ef7b]{width:100%;height:95vh;margin:%?30?% 0;overflow:hidden;display:flex;align-content:center;flex-direction:row;justify-content:center;font-size:%?28?%}.handWriting[data-v-2740ef7b]{background:#fff;width:100%;height:95vh}.handRight[data-v-2740ef7b]{display:inline-flex;align-items:center}.handCenter[data-v-2740ef7b]{border:%?4?% dashed #e9e9e9;flex:5;overflow:hidden;box-sizing:border-box}.handTitle[data-v-2740ef7b]{-webkit-transform:rotate(90deg);transform:rotate(90deg);flex:1;color:#666}.handBtn uni-button[data-v-2740ef7b]{font-size:%?28?%}.handBtn[data-v-2740ef7b]{height:95vh;display:inline-flex;flex-direction:column;justify-content:space-between;align-content:space-between;flex:1}.delBtn[data-v-2740ef7b]{position:absolute;top:%?250?%;left:%?0?%;-webkit-transform:rotate(90deg);transform:rotate(90deg);color:#666}.delBtn uni-image[data-v-2740ef7b]{position:absolute;top:%?13?%;left:%?25?%}.subBtn[data-v-2740ef7b]{position:absolute;bottom:%?52?%;left:%?-3?%;display:inline-flex;-webkit-transform:rotate(90deg);transform:rotate(90deg);background:#008ef6;color:#fff;margin-bottom:%?30?%;text-align:center;justify-content:center}\n\n/*Peach - 新增 - 保存*/.saveBtn[data-v-2740ef7b]{position:absolute;top:%?375?%;left:%?0?%;-webkit-transform:rotate(90deg);transform:rotate(90deg);color:#666}.previewBtn[data-v-2740ef7b]{position:absolute;top:%?500?%;left:%?0?%;-webkit-transform:rotate(90deg);transform:rotate(90deg);color:#666}.uploadBtn[data-v-2740ef7b]{position:absolute;top:%?625?%;left:%?0?%;-webkit-transform:rotate(90deg);transform:rotate(90deg);color:#666}\n\n/*Peach - 新增 - 保存*/.black-select[data-v-2740ef7b]{width:%?60?%;height:%?60?%;position:absolute;top:%?30?%;left:%?25?%}.black-select.color_select[data-v-2740ef7b]{width:%?90?%;height:%?90?%;top:%?100?%;left:%?10?%}.red-select[data-v-2740ef7b]{width:%?60?%;height:%?60?%;position:absolute;top:%?140?%;left:%?25?%}.red-select.color_select[data-v-2740ef7b]{width:%?90?%;height:%?90?%;top:%?120?%;left:%?10?%}",""]),t.exports=e},"75ed":function(t,e,i){"use strict";i.d(e,"b",(function(){return a})),i.d(e,"c",(function(){return n})),i.d(e,"a",(function(){}));var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",[i("v-uni-view",{staticClass:"wrapper"},[i("v-uni-view",{staticClass:"handBtn"},[i("v-uni-image",{class:["black"===t.selectColor?"color_select":"","black-select"],attrs:{src:"black"===t.selectColor?"/static/img/sign/color_black_selected.png":"/static/img/sign/color_black.png"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.selectColorEvent("black","#1A1A1A")}}}),i("v-uni-image",{class:["red"===t.selectColor?"color_select":"","black-select"],attrs:{src:"red"===t.selectColor?"/static/img/sign/color_red_selected.png":"/static/img/sign/color_red.png"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.selectColorEvent("red","#ca262a")}}}),i("v-uni-button",{staticClass:"delBtn",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.retDraw.apply(void 0,arguments)}}},[t._v("重写")]),i("v-uni-button",{staticClass:"saveBtn",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.saveCanvasAsImg.apply(void 0,arguments)}}},[t._v("保存")]),i("v-uni-button",{staticClass:"previewBtn",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.previewCanvasImg.apply(void 0,arguments)}}},[t._v("预览")]),i("v-uni-button",{staticClass:"uploadBtn",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.uploadCanvasImg.apply(void 0,arguments)}}},[t._v("上传")]),i("v-uni-button",{staticClass:"subBtn",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.subCanvas.apply(void 0,arguments)}}},[t._v("完成")]),i("v-uni-button",{staticClass:"subBtn",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.back.apply(void 0,arguments)}}},[t._v("返回")])],1),i("v-uni-view",{staticClass:"handCenter"},[i("v-uni-canvas",{staticClass:"handWriting",attrs:{"disable-scroll":!0,"canvas-id":"handWriting"},on:{touchstart:function(e){arguments[0]=e=t.$handleEvent(e),t.uploadScaleStart.apply(void 0,arguments)},touchmove:function(e){arguments[0]=e=t.$handleEvent(e),t.uploadScaleMove.apply(void 0,arguments)},touchend:function(e){arguments[0]=e=t.$handleEvent(e),t.uploadScaleEnd.apply(void 0,arguments)}}})],1),i("v-uni-view",{staticClass:"handRight"},[i("v-uni-view",{staticClass:"handTitle"},[t._v("请签名")])],1)],1)],1)},n=[]},ee9c:function(t,e,i){var a=i("67d7");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);var n=i("967d").default;n("7cf32f68",a,!0,{sourceMap:!1,shadowMode:!1})}}]);